DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Core.Ef.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF object_id('[core].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [core].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Core.Ef.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201501150651326_Core_Ver1'
BEGIN
    IF schema_id('core') IS NULL
        EXECUTE('CREATE SCHEMA [core]')
    CREATE TABLE [core].[ExceptionLogs] (
        [ID] [uniqueidentifier] NOT NULL DEFAULT newsequentialid(),
        [ExceptionType] [nvarchar](max),
        [Message] [nvarchar](max),
        [StackTrace] [nvarchar](max),
        [Source] [nvarchar](max),
        [TimeStamp] rowversion NOT NULL,
        [InnerException_ID] [uniqueidentifier],
        CONSTRAINT [PK_core.ExceptionLogs] PRIMARY KEY ([ID])
    )
    CREATE INDEX [IX_InnerException_ID] ON [core].[ExceptionLogs]([InnerException_ID])
    CREATE TABLE [core].[Logs] (
        [ID] [uniqueidentifier] NOT NULL DEFAULT newsequentialid(),
        [UserId] [nvarchar](max),
        [CustomMessage] [nvarchar](max),
        [CreateDate] [datetime] NOT NULL,
        [InnerExceptionCount] [int] NOT NULL,
        [TimeStamp] rowversion NOT NULL,
        [ExceptionLog_ID] [uniqueidentifier],
        CONSTRAINT [PK_core.Logs] PRIMARY KEY ([ID])
    )
    CREATE INDEX [IX_ExceptionLog_ID] ON [core].[Logs]([ExceptionLog_ID])
    ALTER TABLE [core].[ExceptionLogs] ADD CONSTRAINT [FK_core.ExceptionLogs_core.ExceptionLogs_InnerException_ID] FOREIGN KEY ([InnerException_ID]) REFERENCES [core].[ExceptionLogs] ([ID])
    ALTER TABLE [core].[Logs] ADD CONSTRAINT [FK_core.Logs_core.ExceptionLogs_ExceptionLog_ID] FOREIGN KEY ([ExceptionLog_ID]) REFERENCES [core].[ExceptionLogs] ([ID])
    CREATE TABLE [core].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_core.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [core].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201501150651326_Core_Ver1', N'Core.Ef.Migrations.Configuration',  0x1F8B0800000000000400ED5A5F6FDB36107F1FB0EF20E8691B522B695FBAC06ED13AC960ACF983382DF65630D2D9214A912A496536867DB23DEC23ED2BEC284BB2444AB66427595B0C41009B7F7EF78777C73B9EFFF9EBEFE1EB45CCBC7B908A0A3EF28F0687BE073C1411E5F3919FEAD9B397FEEB57DF7F373C8DE285F7A158F7C2ACC39D5C8DFC3BAD93E32050E11DC4440D621A4AA1C44C0F4211072412C1F3C3C39F83A3A30010C2472CCF1B5EA75CD318B22FF8752C7808894E093B171130958FE3CC3443F52E480C2A21218CFCB19030389DF9DE1B4609929F02C32F8473A18946E68EDF2B986A29F87C9AE0006137CB0470DD8C300539D3C7EBE55DF93F7C6EF80FD61B0BA830555AC43D018F5EE40A09ECED3BA9D52F15862A3B45D5EAA5913A53DBC83F5D18E522F63B31F73D9BE0F19849B3B8D06CB67B50DD73E055660E4A23405B317F389B329D4A187148B524ECC0BB4A6F190D7F85E58DF8047CC453C6AA1C228F38571BC0A12B2912907A790DB39CEFC989EF05F57D81BDB1DC56D9B392E6979446BE7781B4C92D83F2FC2B824F358AF50B709044437445B40689C737892093D4216E912A5564E81554D1F2D0737CEF9C2CDE019FEBBB918F1F7DEF8C2E202A467256DE738A8E869BB44C611BB573508ACC1F9FCE5493F0D38D44577B7C5222954F40E606030D4A152705A5B7941389C76BA24E2A2586BBE579869691AA71F0B299FE0E56351671926A036F717B41EEE93CDB6A9B32478CD2C87CEF1A58B64CDDD16415F66A5EFAD15E7F26457C2D981500AC651FCB4310DBD7DE1039075D976018ACE3CDC628D423F8FC1F73DA48E1DD2627D1A3BBCC383BA6A70A396309A88C13FC2F4899CFC66D1B74B919AA6EB0638169468139E1FAC5F3DE805F6BF0A8DFF90DA1C3B8777DD13A5ED8734E907016F4890C6F941221CDF86960D60E6375794F79E4F588692BBBB523251E12460F9A60BC40F646FE4F8E5ABB912984EE48E6703038B23554D1C5661539C7D5C670FBD9ADB9ECA983D6D37E78C1571683BEA509455D1701029DE2E4D68CC242375C221815F37B44E511C716C5A04E4137D89BF2BDB599360AE3E8A50ED682D1B4B522743333CE1D5ED9D1E1CAB7AFB77EDE520AE62828D80DB83093AEC035ABC0E51D94E7463157639B5DA79BF35444D8AA92567779003D1431B5F49075A51CAC4AE5A2A40E5A6AEAE1394912BCC72B35763EE24DF302FBD9B47F111AAF30825035D4A225B72525BCE630B3B0668DA3477046A5D29800905B622EC77114372CABC68316F72C6835B9BC7B7885F716BBCCE775F0199C5A41C102582BF10CE58A3197CB4484961377B7672F1D8411D9905A8E054B63DE969E6EDA6D55A855206BAA3B66991456D1CAC1EE38D53AB30A551DEF8196FB690D291FEB8E5249F6AA409561176B1858276FDB56E01897E5ECB6C576B2E79DCD7837EB7D42A32D4A9C2A4231D61DC5AA60AA60D6540FCC4A9D5203AC8C77476B2C556A6A6B5AF0751B73FD5E6B8FD04E1EB4391C3BCBFB045F73736F289E5A921A5775DD5CA10ED6E41946872543FBF19A47C05D79EDCB1C5EC811CD6A968932456E59E0F6D2809DFDF4362437276C8C82D69A0E11AF41FB6DB9DE8E2AAF1FE6FEC6D196CF7E5116B145E8EDF6E024C5F69232AC95C9B195040FF384B44BF7C9CA50574B7C0F55704F23939D4E974A433C300B06D3CF6CCC2898C85D2C38279CCE40E9D53BA58F09F44BAB97F5E5F49502A522D6A3B9F4E40FAE29A79F53A0D9EBE98C82CCFD78D3036BCF07C0C62E0FBF2732BC23F287982C7EAC42EED0C9D90BCBEDD6EC07577B2BDA0BCA793895E2F7BCCDDC7A48EB67CEBD9E7D3F6EB20FE7F168C223588CFC3F32A8636FF29B7D8B4E4E0EBC4B899E7BEC1D7A7F6ED643AF6EC837E82DF5FEC45E06D4D883D80FD1E93344F8593F709F819A8FFB76191ED3599CFB760F57B1B0F67794876F0EECF14CDD8AB9BAA7776E2FA03F83347A260C7316A525662D4EA97525290F694258934C6E02D7255618B597B0F6CC0924C0CDE9B7C9DB896697FAA6A46405B26D6A798C76C963588A0DF5EDD84457321DEA98073782B6D691FDA2DCBD35B4B533B4CAFD477E88011A4F7C15EB363FED37748FDA9A478DE88DA05F465FA9B5C1D1B981B40AAB1D51FEFB6ED1FEC2DB1BFB89D9A319E4D6B7E86995DF60A2A72B3A5F4398CA9D4358F3B172CD84CF44E1F31647C512A7E4D104732DF246626E41428DD3212676D9CF493E10961A65C6B7104DF865AA31AB419121BE65B59FC39890B1897ED6F1AAF33CBCCC4E413D8408C82635E9E2257F9B5216957C9FB929571B848945791E67CE529B7C6EBE2C912E04EF0894ABAF0CA13710270CC1D4259F927BD885374CDCDFC19C84CBE299A21D64FB41D4D53E3CA1642E49AC728CF57EFC8A361CC58B57FF028BDBD8378A2C0000 , N'6.1.1-30610')
END

